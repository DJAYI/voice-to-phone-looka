---
import initUrl from "./rates-search.js?url";
const { dataUrl = "/data/calls-voip.json" } = Astro.props;
const uid = `rates-${Math.random().toString(36).slice(2, 8)}`;
---

<div id={uid} data-rates-url={dataUrl} data-module-url={initUrl} class="mt-6">
  <label for={`${uid}-search`} class="sr-only">Buscar destinos</label>
  <div class="relative max-w-md">
    <input
      id={`${uid}-search`}
      type="search"
      placeholder="Buscar destino, operador o tipo..."
      class="w-full rounded-md border bg-slate-900 px-4 py-2 text-white placeholder:text-slate-400"
    />
  </div>

  <div
    id={`${uid}-grid`}
    data-rates-grid
    class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
  </div>

  <div id={`${uid}-no-results`} class="mt-4 hidden p-4 text-sm text-slate-200">
    No se encontraron destinos que coincidan con tu b√∫squeda.
  </div>
</div>

<script type="module" client:load>
  (async () => {
    try {
      const el = document.querySelector("[data-module-url]");
      const moduleUrl = el && el.getAttribute("data-module-url");
      if (!moduleUrl) throw new Error("moduleUrl not found");
      const m = await import(moduleUrl);
      if (m && m.autoInit) {
        m.autoInit();
      } else if (m && m.default) {
        try {
          m.default();
        } catch (e) {
          console.error("fallback init failed", e);
        }
      }
    } catch (e) {
      console.error("Failed to load rates-search module", e);
    }
  })();
</script>
